<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mzansi Legal - Your Guide to South African Law</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
        }
        .hero-bg {
            background-color: #1e3a8a;
            background-image: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%);
        }
        .chat-bubble-user {
            background-color: #dbeafe;
            border-radius: 1.5rem 1.5rem 0.25rem 1.5rem;
        }
        .chat-bubble-bot {
            background-color: #e5e7eb;
            border-radius: 1.5rem 1.5rem 1.5rem 0.25rem;
        }
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3b82f6;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .law-list-item {
            transition: background-color 0.2s;
        }
        .law-list-item:hover {
            background-color: #f4f4f5;
        }
    </style>
</head>
<body class="text-gray-800">

    <!-- Header -->
    <header class="bg-white shadow-sm sticky top-0 z-50">
        <nav class="container mx-auto px-4 lg:px-6 py-4 flex justify-between items-center">
            <a href="#" class="flex items-center space-x-2">
                <i data-lucide="scale" class="text-blue-600"></i>
                <span class="text-2xl font-bold text-gray-800">Mzansi Legal</span>
            </a>
            <div class="hidden lg:flex items-center space-x-8">
                <a href="#home" class="text-gray-600 hover:text-blue-600 transition-colors">Home</a>
                <a href="#categories" class="text-gray-600 hover:text-blue-600 transition-colors">Browse Laws</a>
                <a href="#chatbot" class="text-gray-600 hover:text-blue-600 transition-colors">Chatbot</a>
                <a href="#about" class="text-gray-600 hover:text-blue-600 transition-colors">About</a>
            </div>
            <button id="mobile-menu-button" class="lg:hidden">
                <i data-lucide="menu" class="h-6 w-6"></i>
            </button>
        </nav>
        <!-- Mobile Menu -->
        <div id="mobile-menu" class="hidden lg:hidden px-4 pb-4">
            <a href="#home" class="block py-2 text-gray-600 hover:text-blue-600">Home</a>
            <a href="#categories" class="block py-2 text-gray-600 hover:text-blue-600">Browse Laws</a>
            <a href="#chatbot" class="block py-2 text-gray-600 hover:text-blue-600">Chatbot</a>
            <a href="#about" class="block py-2 text-gray-600 hover:text-blue-600">About</a>
        </div>
    </header>

    <main>
        <!-- Hero Section -->
        <section id="home" class="hero-bg text-white py-20 lg:py-32">
            <div class="container mx-auto px-4 text-center">
                <h1 class="text-4xl lg:text-6xl font-bold mb-4">Understanding South African Law, Made Simple.</h1>
                <p class="text-lg lg:text-xl text-blue-100 max-w-3xl mx-auto mb-8">Your trusted guide to the laws that shape our nation. Search, learn, and get clarity on your rights and obligations.</p>
                <a href="#chatbot" class="bg-white text-blue-600 font-bold py-3 px-8 rounded-full hover:bg-blue-50 transition-transform transform hover:scale-105 inline-block">Ask our Chatbot</a>
            </div>
        </section>

        <!-- Law of the Day Section -->
        <section id="law-of-the-day" class="py-16 bg-white">
            <div class="container mx-auto px-4">
                <div class="bg-blue-50 border-l-4 border-blue-500 text-blue-900 p-6 rounded-r-lg shadow-md">
                    <div class="flex items-center mb-4">
                        <i data-lucide="gavel" class="h-8 w-8 mr-4 text-blue-600"></i>
                        <h2 class="text-2xl font-bold">Law of the Day</h2>
                    </div>
                    <div id="lotd-content">
                        <div class="flex items-center justify-center h-32">
                            <div class="loader"></div>
                        </div>
                    </div>
                     <div class="text-xs text-gray-500 mt-4">
                        Disclaimer: The "Law of the Day" provides a simplified explanation for educational purposes and is not legal advice. The explanation is AI-generated.
                    </div>
                </div>
            </div>
        </section>

        <!-- Categories Section -->
        <section id="categories" class="py-16">
            <div class="container mx-auto px-4">
                <h2 class="text-3xl font-bold text-center mb-2">Browse by Category</h2>
                <p class="text-center text-gray-600 mb-12">Find laws related to specific areas of your life and work.</p>
                <div id="category-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-8">
                    <!-- Category cards will be dynamically inserted here -->
                </div>
            </div>
        </section>
        
        <!-- Law Display Modal -->
        <div id="law-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4 z-50">
            <div class="bg-white rounded-lg shadow-2xl max-w-2xl w-full max-h-[90vh] flex flex-col">
                <div class="p-4 border-b flex justify-between items-center sticky top-0 bg-white flex-shrink-0">
                    <button id="modal-back-button" class="hidden text-gray-600 hover:text-gray-900">
                        <i data-lucide="arrow-left" class="h-6 w-6"></i>
                    </button>
                    <h3 id="modal-title" class="text-xl font-bold text-center flex-grow"></h3>
                    <button id="close-modal-button" class="text-gray-500 hover:text-gray-800">
                        <i data-lucide="x" class="h-6 w-6"></i>
                    </button>
                </div>
                <div id="modal-content" class="p-6 overflow-y-auto">
                    <!-- Modal content will be dynamically inserted here -->
                </div>
            </div>
        </div>


        <!-- Chatbot Section -->
        <section id="chatbot" class="py-16 bg-white">
            <div class="container mx-auto px-4">
                <div class="max-w-3xl mx-auto">
                    <h2 class="text-3xl font-bold text-center mb-2">Mzansi Legal Chatbot</h2>
                    <p class="text-center text-gray-600 mb-8">Ask a question to find a law or understand a legal concept. Please note, I am an AI assistant and cannot provide legal advice.</p>
                    
                    <div class="bg-white border border-gray-200 rounded-lg shadow-lg">
                        <div id="chat-window" class="h-96 p-4 overflow-y-auto">
                            <div class="flex items-start space-x-3">
                                <div class="flex-shrink-0 h-10 w-10 rounded-full bg-gray-200 flex items-center justify-center">
                                    <i data-lucide="bot" class="text-gray-600"></i>
                                </div>
                                <div class="flex-1">
                                    <div class="chat-bubble-bot p-3">
                                        <p class="text-sm">Hello! How can I help you understand South African law today? You can ask me things like "What are my rights as a consumer?" or "Is it legal to record a police officer?".</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="p-4 border-t border-gray-200">
                            <form id="chat-form" class="flex items-center space-x-2">
                                <input type="text" id="chat-input" placeholder="Type your legal question here..." class="w-full px-4 py-2 border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-blue-500" autocomplete="off">
                                <button type="submit" class="bg-blue-600 text-white rounded-full p-3 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:bg-blue-300">
                                    <i data-lucide="send" class="h-5 w-5"></i>
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- About Section -->
        <section id="about" class="py-16">
            <div class="container mx-auto px-4 text-center max-w-4xl">
                 <h2 class="text-3xl font-bold mb-4">About Mzansi Legal</h2>
                 <p class="text-gray-600 mb-4">Mzansi Legal was founded on the principle that every South African deserves to understand the laws that govern their lives. Legal language is often complex and inaccessible, creating a barrier to justice and empowerment. Our mission is to break down this barrier by providing clear, simple, and accurate explanations of South African legislation.</p>
                 <p class="text-gray-600">Using advanced AI, we translate dense legal jargon into plain English, helping you understand your rights and responsibilities. While our platform is a powerful educational tool, it is not a substitute for professional legal advice. We always recommend consulting with a qualified attorney for specific legal issues.</p>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white py-12">
        <div class="container mx-auto px-4 text-center">
            <p>&copy; 2024 Mzansi Legal. All Rights Reserved.</p>
            <p class="text-sm text-gray-400 mt-2">A project for enhancing legal literacy in South Africa.</p>
            <div class="flex justify-center space-x-4 mt-4">
                <a href="#" class="text-gray-400 hover:text-white"><i data-lucide="twitter"></i></a>
                <a href="#" class="text-gray-400 hover:text-white"><i data-lucide="facebook"></i></a>
                <a href="#" class="text-gray-400 hover:text-white"><i data-lucide="linkedin"></i></a>
            </div>
        </div>
    </footer>

    <script>
        // --- Lucide Icons ---
        lucide.createIcons();

        // --- Mobile Menu ---
        const mobileMenuButton = document.getElementById('mobile-menu-button');
        const mobileMenu = document.getElementById('mobile-menu');
        mobileMenuButton.addEventListener('click', () => {
            mobileMenu.classList.toggle('hidden');
        });

        // --- EXPANDED Law Database with Hardcoded Explanations ---
        const lawDatabase = [
            // Consumer Law
            { title: "Right to Fair Value", category: "Consumer Law", fullText: "Section 48(1) of the Consumer Protection Act 68 of 2008 states that a supplier must not offer to supply, supply, or enter into an agreement to supply any goods or services at a price that is unfair, unreasonable or unjust.", simplified: "Shops can't charge unfair or unreasonable prices. You have a right to get fair value for your money.", keywords: ["consumer", "price", "fair", "goods", "services", "cpa"] },
            { title: "Right to Return Goods", category: "Consumer Law", fullText: "Section 20 of the Consumer Protection Act 68 of 2008 gives consumers the right to return goods and receive a full refund under specific circumstances, such as when goods were for a specific purpose and are found to be unsuitable.", simplified: "You can return goods for a full refund if they were meant for a specific purpose you communicated and they aren't suitable.", keywords: ["return", "refund", "cpa", "consumer", "goods"] },
            { title: "Plain and Understandable Language", category: "Consumer Law", fullText: "Section 22 of the Consumer Protection Act 68 of 2008 requires that any agreement or document provided to a consumer must be in plain and understandable language.", simplified: "All contracts and legal documents given to you must be written in simple language that you can easily understand.", keywords: ["contract", "plain language", "agreement", "cpa"] },
            { title: "Implied Warranty of Quality", category: "Consumer Law", fullText: "Section 56 of the Consumer Protection Act 68 of 2008 provides an implied warranty that all goods sold are of good quality, in good working order, and free of defects. Consumers can return faulty goods within six months for a refund, replacement, or repair.", simplified: "Everything you buy has a 6-month guarantee of quality. If it's faulty, you can get it repaired, replaced, or refunded.", keywords: ["warranty", "defective", "broken", "quality", "cpa"] },
            // Data Privacy
            { title: "Conditions for Lawful Processing", category: "Data Privacy", fullText: "Section 11(1) of the Protection of Personal Information Act 4 of 2013 states that personal information may only be processed if the data subject consents to its processing, or processing is necessary to carry out actions for the conclusion or performance of a contract.", simplified: "Companies can only use your personal info if you agree, or if it's necessary for a contract you're part of.", keywords: ["popi", "privacy", "data", "consent", "processing"] },
            { title: "Notification of Security Compromises", category: "Data Privacy", fullText: "Section 22 of the Protection of Personal Information Act 4 of 2013 requires a responsible party to notify the Information Regulator and the data subject as soon as reasonably possible after discovering a security compromise.", simplified: "If a company gets hacked and your data is exposed, they must tell you and the Information Regulator about it.", keywords: ["data breach", "hack", "security", "popi", "notification"] },
            { title: "Restrictions on Direct Marketing", category: "Data Privacy", fullText: "Section 69 of the Protection of Personal Information Act 4 of 2013 prohibits direct marketing by means of unsolicited electronic communications, unless the data subject has given their consent or is an existing customer.", simplified: "Companies can't send you marketing messages (like SMS or email) unless you've agreed to it or you're already their customer.", keywords: ["spam", "marketing", "sms", "email", "popi"] },
            { title: "Access to Personal Information", category: "Data Privacy", fullText: "Section 23 of the Protection of Personal Information Act 4 of 2013 gives a data subject the right to request confirmation of whether a responsible party holds personal information about them, and to access that information.", simplified: "You have the right to ask a company if they have your personal information and to see what information they have.", keywords: ["access", "my data", "request information", "popi"] },
            // Labour Law
            { title: "Regulation of Working Time", category: "Labour Law", fullText: "Section 9 of the Basic Conditions of Employment Act 75 of 1997 states that an employer may not require or permit an employee to work more than 45 hours in any week.", simplified: "Your employer cannot legally make you work more than 45 hours in a standard week.", keywords: ["work", "hours", "labour", "employment", "bcea"] },
            { title: "Overtime Pay", category: "Labour Law", fullText: "Section 10 of the Basic Conditions of Employment Act 75 of 1997 stipulates that an employer must pay an employee at least one and one-half times the employee's wage for overtime worked.", simplified: "If you work overtime, your employer must pay you 1.5 times your normal hourly wage for those extra hours.", keywords: ["overtime", "payment", "work hours", "bcea"] },
            { title: "Annual Leave", category: "Labour Law", fullText: "Section 20 of the Basic Conditions of Employment Act 75 of 1997 entitles an employee to at least 21 consecutive days' annual leave on full remuneration in respect of each annual leave cycle.", simplified: "You are entitled to at least 21 consecutive days of paid leave for every year you work.", keywords: ["leave", "holiday", "annual leave", "bcea"] },
            { title: "Notice of Termination of Employment", category: "Labour Law", fullText: "Section 37 of the Basic Conditions of Employment Act 75 of 1997 requires notice of termination of an employment contract to be not less than one week if the employee has been employed for six months or less, and four weeks if employed for more than a year.", simplified: "To end your contract, you must be given at least one week's notice if you've worked for 6 months or less, and four weeks' notice if you've worked for more than a year.", keywords: ["firing", "resignation", "notice period", "termination", "bcea"] },
            // Constitutional Law
            { title: "Right to Equality", category: "Constitutional Law", fullText: "Section 9 of the Constitution of the Republic of South Africa, 1996 states that everyone is equal before the law and has the right to equal protection and benefit of the law.", simplified: "Everyone is equal in the eyes of the law and has the right to be treated equally and receive the same legal protections.", keywords: ["constitution", "equality", "rights", "discrimination"] },
            { title: "Human Dignity", category: "Constitutional Law", fullText: "Section 10 of the Constitution of the Republic of South Africa, 1996 states that everyone has inherent dignity and the right to have their dignity respected and protected.", simplified: "You have a fundamental right to be treated with respect and to have your personal dignity protected.", keywords: ["dignity", "human rights", "constitution"] },
            { title: "Freedom of Expression", category: "Constitutional Law", fullText: "Section 16 of the Constitution of the Republic of South Africa, 1996 guarantees the right to freedom of expression, which does not extend to propaganda for war, incitement of imminent violence, or advocacy of hatred.", simplified: "You can express your opinions freely, but this right doesn't cover war propaganda, inciting violence, or hate speech.", keywords: ["free speech", "expression", "protest", "constitution"] },
            { title: "Just Administrative Action", category: "Constitutional Law", fullText: "Section 33 of the Constitution of the Republic of South Africa, 1996 states that everyone has the right to administrative action that is lawful, reasonable and procedurally fair.", simplified: "When the government makes a decision that affects you, they must do so in a way that is lawful, reasonable, and fair.", keywords: ["government", "fair procedure", "administrative justice", "paja"] },
            // Property Law
            { title: "Landlord's Right to Entry", category: "Property Law", fullText: "Section 5(3)(e) of the Rental Housing Act 50 of 1999 provides that the landlord may enter the dwelling for purposes of inspection or repairs, provided that the landlord has given reasonable notice.", simplified: "Your landlord cannot enter your home whenever they want. They must give you reasonable notice first and come at a reasonable time.", keywords: ["rent", "landlord", "tenant", "entry", "inspection"] },
            { title: "Tenant's Deposit", category: "Property Law", fullText: "Section 5(3)(g) of the Rental Housing Act 50 of 1999 states that a landlord must place a tenant's deposit in an interest-bearing account with a financial institution.", simplified: "A landlord must keep your rental deposit in a bank account that earns interest, which must be paid back to you.", keywords: ["deposit", "rent", "lease", "interest"] },
            { title: "Unlawful Eviction", category: "Property Law", fullText: "Section 3 of the Prevention of Illegal Eviction from and Unlawful Occupation of Land Act 19 of 1998 (PIE Act) requires a court order for the eviction of an unlawful occupier.", simplified: "A landlord cannot just kick you out. They must get a court order to legally evict you from a property.", keywords: ["eviction", "pie act", "unlawful occupier", "court order"] },
            { title: "Landlord's Duty of Maintenance", category: "Property Law", fullText: "Common law, as reflected in the Rental Housing Act 50 of 1999, places a duty on the landlord to ensure the property is in a habitable condition at the start of and during the lease.", simplified: "The landlord is responsible for making sure the property is in a good, liveable condition when you move in and throughout your lease.", keywords: ["repairs", "maintenance", "habitable", "landlord duty"] },
            // Financial Law
            { title: "Reckless Credit", category: "Financial Law", fullText: "Section 80(1) of the National Credit Act 34 of 2005 states that a credit agreement is reckless if the credit provider failed to conduct a proper affordability assessment.", simplified: "It's illegal for a lender to give you credit if they didn't check properly whether you could afford to repay it.", keywords: ["credit", "loan", "debt", "reckless", "nca", "affordability"] },
            { title: "Right to a Credit Record", category: "Financial Law", fullText: "Section 70 of the National Credit Act 34 of 2005 gives every consumer the right to access their credit report from a credit bureau, free of charge, once per year.", simplified: "You have the right to get one free copy of your credit report from any credit bureau every year.", keywords: ["credit score", "credit report", "transunion", "experian", "nca"] },
            { title: "Debt Counselling", category: "Financial Law", fullText: "Section 86 of the National Credit Act 34 of 2005 allows an over-indebted consumer to apply for debt counselling to develop a plan to restructure their debt payments.", simplified: "If you are over-indebted, you can apply for debt counselling to have your payments restructured in a way you can afford.", keywords: ["debt review", "debt counselling", "over-indebted", "nca"] },
            { title: "Prohibited Clauses in Credit Agreements", category: "Financial Law", fullText: "Section 90 of the National Credit Act 34 of 2005 outlaws certain clauses in credit agreements, such as those that waive a consumer's rights or require them to leave their ID book or bank card as security.", simplified: "A credit agreement cannot contain illegal terms, like forcing you to give up your ID book as security for a loan.", keywords: ["contract", "unlawful clause", "credit agreement", "nca"] },
            // Cyber Law
            { title: "Malicious Communications", category: "Cyber Law", fullText: "Section 14 of the Cybercrimes Act 19 of 2020 criminalises the disclosure of a data message which is harmful, including messages that incite violence or damage to property, and intimate images.", simplified: "It's a crime to send or share messages online that are harmful, incite violence, or distribute someone's private intimate images.", keywords: ["cybercrime", "online", "harmful message", "threats", "revenge porn"] },
            { title: "Unlawful Access", category: "Cyber Law", fullText: "Section 2 of the Cybercrimes Act 19 of 2020 makes it an offence to unlawfully and intentionally access data, a computer program, or a computer data storage medium.", simplified: "Illegally accessing someone else's computer, data, or online profile without permission is a crime, commonly known as hacking.", keywords: ["hacking", "unlawful access", "cybercrime"] },
            { title: "Cyber Fraud", category: "Cyber Law", fullText: "Section 8 of the Cybercrimes Act 19 of 2020 criminalises any misrepresentation made with the intent to defraud, causing actual or potential prejudice to another, through the use of data or a computer program.", simplified: "Using a computer or the internet to lie or deceive someone in order to cause them financial or other harm is a crime.", keywords: ["phishing", "scam", "online fraud", "cybercrime"] },
            { title: "Cyber Extortion", category: "Cyber Law", fullText: "Section 9 of the Cybercrimes Act 19 of 2020 makes it an offence to unlawfully make a threat with the intention to extort an advantage from another person, through the use of data or a computer program.", simplified: "Threatening someone online to get something from them, for example using ransomware, is a crime known as cyber extortion.", keywords: ["ransomware", "blackmail", "extortion", "cybercrime"] },
            // Wills & Estates
            { title: "Formalities of a Will", category: "Wills & Estates", fullText: "Section 2(1)(a) of the Wills Act 7 of 1953 requires that a will must be signed at the end by the testator in the presence of two or more competent witnesses present at the same time.", simplified: "For a will to be valid, you must sign it at the end, and two witnesses must be present at the same time to see you sign it.", keywords: ["will", "death", "estate", "inheritance", "witness"] },
            { title: "Capacity to Make a Will", category: "Wills & Estates", fullText: "Section 4 of the Wills Act 7 of 1953 states that every person of the age of sixteen years or more may make a will unless at the time of making the will they are mentally incapable of appreciating the consequence of their act.", simplified: "Anyone aged 16 or older can make a will, as long as they are of sound mind and understand what they are doing.", keywords: ["mental capacity", "making a will", "valid will"] },
            { title: "Intestate Succession", category: "Wills & Estates", fullText: "The Intestate Succession Act 81 of 1987 prescribes how a person's estate is to be divided if they die without a valid will. The estate is typically divided among the surviving spouse and children.", simplified: "If you die without a valid will, the law decides how your property is shared, usually between your spouse and children.", keywords: ["no will", "intestate", "heirs", "inheritance"] },
            { title: "Executor's Duties", category: "Wills & Estates", fullText: "The Administration of Estates Act 66 of 1965 outlines the duties of an executor, which include collecting the assets of the deceased, settling their debts, and distributing the balance of the estate to the rightful heirs.", simplified: "The executor of a will is responsible for managing the deceased's estate: paying debts and sharing the remaining assets with the heirs.", keywords: ["executor", "administering estate", "deceased estate"] },
        ];

        // --- NEW Law of the Day Pool ---
        const lawOfTheDayPool = [
            { title: "Smoking in Public Places", fullText: "Section 2 of the Tobacco Products Control Act 83 of 1993 prohibits smoking in any public place, but allows for designated smoking areas under strict conditions." },
            { title: "Speed Limits", fullText: "Regulation 292 of the National Road Traffic Act 93 of 1996 sets the general speed limits in South Africa: 60 km/h in urban areas, 100 km/h on public roads outside urban areas, and 120 km/h on freeways." },
            { title: "Cruelty to Animals", fullText: "Section 2(1) of the Animals Protection Act 71 of 1962 makes it an offence to overload, overdrive, torture, beat, kick, or terrify any animal." },
            { title: "Selling Alcohol to Minors", fullText: "The Liquor Act 59 of 2003 prohibits the sale or supply of liquor to persons under the age of 18." },
            { title: "Compulsory School Attendance", fullText: "Section 3(1) of the South African Schools Act 84 of 1996 states that every parent must cause every learner for whom he or she is responsible to attend a school from the first school day of the year in which such learner reaches the age of seven years until the last school day of the year in which such learner reaches the age of fifteen years or the ninth grade, whichever occurs first." },
            { title: "Duty to Report Child Abuse", fullText: "Section 110 of the Children's Act 38 of 2005 places a legal duty on certain persons, including correctional officials, health service professionals, and educators, to report any suspicion of child abuse or neglect to the relevant authorities." },
            { title: "Carrying an ID", fullText: "Section 18 of the Identification Act 68 of 1997 does not explicitly require you to carry your ID at all times, but you must be able to prove your identity to a police officer if requested." },
            { title: "Patient Consent", fullText: "Section 6 of the National Health Act 61 of 2003 establishes that a health service may not be provided to a user without the user's informed consent." },
            { title: "Applying for a Protection Order", fullText: "The Domestic Violence Act 116 of 1998 allows a victim of domestic violence to apply to a court for a protection order against the person committing the act of violence." },
            { title: "Copyright and Fair Dealing", fullText: "The Copyright Act 98 of 1978 allows for 'fair dealing' with a work for the purposes of research, private study, criticism, or review without infringing copyright." },
            { title: "RICA and SIM Cards", fullText: "The Regulation of Interception of Communications and Provision of Communication-Related Information Act 70 of 2002 (RICA) requires all new and existing cellphone SIM cards to be registered with the user's personal details." },
            { title: "Definition of Consent (Sexual Offences)", fullText: "The Sexual Offences Act 32 of 2007 defines consent as a voluntary and uncoerced agreement. Silence or a lack of resistance does not signify consent." },
            { title: "The Common Law Crime of Defamation", fullText: "Under South African common law, defamation is the unlawful and intentional publication of a statement that injures another person's reputation." },
            { title: "Minimum Sentences", fullText: "The Criminal Law Amendment Act 105 of 1997 prescribes minimum sentences for a range of serious offences, such as murder, rape, and robbery with aggravating circumstances." },
            { title: "Requirements for a Valid Marriage", fullText: "The Marriage Act 25 of 1961 requires that for a marriage to be valid, it must be solemnised by a competent marriage officer in the presence of the parties and at least two competent witnesses." }
        ];

        
        // Gemini API Call
        async function callGemini(prompt) {
            const apiUrl = "https://api.mzansilegal.co.za/api/gemini";
            const payload = { prompt };

            for (let i = 0; i < 2; i++) {
                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (response.ok) {
                        const result = await response.json();
                        return result?.candidates?.[0]?.content?.parts?.[0]?.text || "No response from Gemini.";
                    }
                } catch (err) {
                    console.warn(`Attempt ${i + 1} failed, retrying...`);
                    await new Promise(r => setTimeout(r, 2000)); // wait 2s before retry
                }
            }

            return "Connection error â€” backend may still be waking up.";
        }



        async function getSimpleExplanation(lawText) {
            const prompt = `Explain the following South African law in simple, conversational language for a layperson. Keep it under 50 words. Law: "${lawText}"`;
            return await callGemini(prompt);
        }
        
        // ** V4 - UPGRADED CHATBOT LOGIC **
        async function getChatbotResponse(userQuery) {
            const queryWords = userQuery.toLowerCase().split(/\s+/).filter(w => w.length > 2);
            const relevantLaws = lawDatabase.filter(law => queryWords.some(word => law.keywords.includes(word)));

            let lawContext = "";
            if (relevantLaws.length > 0) {
                lawContext = "Here is some potentially relevant legal text from our verified database:\n\n" + relevantLaws.map(law => `Title: ${law.title}\nText: ${law.fullText}`).join("\n\n---\n\n");
            }

            const prompt = `You are "Mzansi Legal", an expert AI assistant for South African law. Your primary function is to answer user queries by first providing the relevant legal text and then offering a simple explanation.

            **Context from our verified database (if any):**
            ${lawContext || "No specific context found in our database for this query."}

            **User's Query:**
            "${userQuery}"

            **Your Task:**
            1.  Analyze the user's query to understand the legal question.
            2.  Based on the query, your general knowledge of South African law, and the provided context, identify the most relevant law or legal principle.
            3.  **Your response MUST follow this format:**
                a.  **Start with the direct legal text.** For example: "The relevant law is Section 16(1) of the Constitution of the Republic of South Africa, 1996, which states: '[Quote the full text of the section here]'." If it's a common law principle, state it clearly, for example: "Under South African common law, theft is defined as '...'. "
                b.  **Follow with a simple explanation.** For example: "In simple terms, this means..."
                c.  If you cannot find a specific law, you must state: "I could not find a specific law or act that directly addresses your query, but I can provide some general information." Then provide the general info.
            4.  **Do not** mention that you are checking a database or that you are using general knowledge. Just provide the best possible answer in the format above.
            5.  **Crucially, always end your entire response with the disclaimer:** "Remember, this information is for educational purposes only, is not legal advice, and you should consult a qualified legal professional for specific issues."`;

            return await callGemini(prompt);
        }


        // --- Page Initialization ---
        document.addEventListener('DOMContentLoaded', () => {
            populateCategories();
            loadLawOfTheDay();

            const modal = document.getElementById('law-modal');
            const closeModalButton = document.getElementById('close-modal-button');
            const modalContent = document.getElementById('modal-content');
            const modalTitle = document.getElementById('modal-title');
            const backButton = document.getElementById('modal-back-button');

            // --- Modal: Show Category List ---
            document.getElementById('category-grid').addEventListener('click', (e) => {
                const card = e.target.closest('.category-card');
                if (card) {
                    const category = card.dataset.category;
                    renderCategoryListView(category);
                    modal.classList.remove('hidden');
                    modal.classList.add('flex');
                }
            });

            // --- Modal: Handle Clicks Inside (List Items & Back Button) ---
            modal.addEventListener('click', (e) => {
                const lawItem = e.target.closest('.law-list-item');
                if (lawItem) {
                    const lawTitle = lawItem.dataset.lawTitle;
                    const category = lawItem.dataset.category;
                    renderLawDetailView(lawTitle, category);
                }

                if (e.target.closest('#modal-back-button')) {
                    const category = backButton.dataset.category;
                    renderCategoryListView(category);
                }
                
                if (e.target === modal || e.target.closest('#close-modal-button')) {
                    modal.classList.add('hidden');
                    modal.classList.remove('flex');
                }
            });
            
            function renderCategoryListView(category) {
                modalTitle.textContent = category;
                backButton.classList.add('hidden');
                
                const lawsInCategory = lawDatabase.filter(law => law.category === category);
                let listHtml = '<ul class="space-y-2">';
                lawsInCategory.forEach(law => {
                    listHtml += `
                        <li class="law-list-item p-4 border rounded-md cursor-pointer flex justify-between items-center" data-law-title="${law.title}" data-category="${law.category}">
                            <span>${law.title}</span>
                            <i data-lucide="chevron-right" class="h-5 w-5 text-gray-400"></i>
                        </li>`;
                });
                listHtml += '</ul>';
                modalContent.innerHTML = listHtml;
                lucide.createIcons();
            }

            function renderLawDetailView(lawTitleText, category) {
                const law = lawDatabase.find(l => l.title === lawTitleText);
                if (!law) return;

                modalTitle.textContent = law.title;
                backButton.classList.remove('hidden');
                backButton.dataset.category = category;

                // Use the hardcoded simplified explanation directly
                modalContent.innerHTML = `
                    <h4 class="font-bold text-lg mb-2 text-gray-700">Simplified Explanation:</h4>
                    <p id="modal-explanation" class="mb-6 text-gray-600">${law.simplified}</p>
                    <h4 class="font-bold text-lg mb-2 text-gray-700">Full Legal Text:</h4>
                    <pre class="bg-gray-100 p-4 rounded-md text-sm whitespace-pre-wrap font-mono">${law.fullText}</pre>
                `;
            }

            // --- Chatbot Logic ---
            const chatForm = document.getElementById('chat-form');
            const chatInput = document.getElementById('chat-input');
            const chatWindow = document.getElementById('chat-window');

            chatForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const userInput = chatInput.value.trim();
                if (!userInput) return;

                addMessageToChat(userInput, 'user');
                chatInput.value = '';
                chatInput.disabled = true;
                chatForm.querySelector('button').disabled = true;

                addMessageToChat('', 'loading');

                const botResponse = await getChatbotResponse(userInput);
                
                document.getElementById('loading-bubble')?.remove();
                addMessageToChat(botResponse, 'bot');
                chatInput.disabled = false;
                chatForm.querySelector('button').disabled = false;
                chatInput.focus();
            });

            function addMessageToChat(text, sender) {
                const messageWrapper = document.createElement('div');
                if (sender === 'loading') {
                    messageWrapper.id = 'loading-bubble';
                    messageWrapper.innerHTML = `<div class="flex items-start space-x-3"><div class="flex-shrink-0 h-10 w-10 rounded-full bg-gray-200 flex items-center justify-center"><i data-lucide="bot" class="text-gray-600"></i></div><div class="flex-1"><div class="chat-bubble-bot p-3"><div class="flex items-center space-x-2"><div class="loader !w-5 !h-5"></div> <span>Thinking...</span></div></div></div></div>`;
                } else if (sender === 'user') {
                     messageWrapper.innerHTML = `<div class="flex items-start justify-end space-x-3"><div class="flex-1"><div class="chat-bubble-user p-3 inline-block float-right"><p class="text-sm text-right">${text}</p></div></div><div class="flex-shrink-0 h-10 w-10 rounded-full bg-blue-500 text-white flex items-center justify-center"><i data-lucide="user" class="h-5 w-5"></i></div></div>`;
                } else {
                    messageWrapper.innerHTML = `<div class="flex items-start space-x-3"><div class="flex-shrink-0 h-10 w-10 rounded-full bg-gray-200 flex items-center justify-center"><i data-lucide="bot" class="text-gray-600"></i></div><div class="flex-1"><div class="chat-bubble-bot p-3"><p class="text-sm">${text.replace(/\n/g, '<br>')}</p></div></div></div>`;
                }
                messageWrapper.classList.add('mb-4');
                chatWindow.appendChild(messageWrapper);
                chatWindow.scrollTop = chatWindow.scrollHeight;
                if (sender !== 'loading') { lucide.createIcons(); }
            }
        });
        
        function populateCategories() {
            const grid = document.getElementById('category-grid');
            const categories = [...new Set(lawDatabase.map(law => law.category))];
            const icons = {
                "Consumer Law": "shopping-cart", "Data Privacy": "shield", "Labour Law": "briefcase", "Constitutional Law": "landmark",
                "Property Law": "home", "Financial Law": "piggy-bank", "Cyber Law": "fingerprint", "Wills & Estates": "file-text"
            };

            categories.forEach(category => {
                const card = document.createElement('div');
                card.className = 'category-card bg-white p-6 rounded-lg shadow-md hover:shadow-xl hover:-translate-y-1 transition-all cursor-pointer';
                card.dataset.category = category;
                card.innerHTML = `
                    <div class="flex items-center justify-center bg-blue-100 rounded-full h-16 w-16 mb-4 mx-auto">
                        <i data-lucide="${icons[category] || 'scale'}" class="text-blue-600 h-8 w-8"></i>
                    </div>
                    <h3 class="font-bold text-lg mb-2 text-center">${category}</h3>
                    <p class="text-gray-600 text-sm text-center">4 important laws</p>
                `;
                grid.appendChild(card);
            });
            lucide.createIcons();
        }

        async function loadLawOfTheDay() {
            const contentDiv = document.getElementById('lotd-content');
            const law = lawOfTheDayPool[Math.floor(Math.random() * lawOfTheDayPool.length)];
            const explanation = await getSimpleExplanation(law.fullText);
            contentDiv.innerHTML = `
                <blockquote class="italic text-gray-700 mb-4">"${law.fullText}"</blockquote>
                <p class="font-semibold text-blue-800">In simple terms:</p>
                <p>${explanation}</p>
                <p class="text-sm text-right mt-4 font-semibold">- ${law.title}</p>`;
        }
    </script>
</body>
</html>
